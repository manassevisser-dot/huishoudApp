{
  "Producing_Role": "CEO Manasse",
  "Artifact_ID": "SVZ-0-DOMME_UI_001",
  "Status": "PENDING",
  "Token_ID": "TOKEN-ID-MANASSE-SVZ0-1C4D9E7B",
  "Runtime_Environment": "NODE_TERMINAL",
  "SHA256_Hash": "1c4d9e7b83e618d0d678a0b54a4c53b86fd83613cc89706cd6a962a48e39b449",
  "Source_Commit": "MANUAL_CLI_INPUT",
  "PII_Attestation": "NEE - CLEAN",
  "File_Name": "Domme_UI_F1.txt",
  "Raw_Content": "FASE 1 DOMMER MAKEN UI: Gebruik van datakeys en state.\n======================\nsrc/ui/components/FieldRenderer.tsx\nimport * as React from 'react';\nimport { FieldConfig, FormState, FormAction } from '@shared-types/form';\nimport FormField from '@fields/FormField';\nimport { evaluateVisibleIf } from '../../utils/fieldVisibility';\n\nexport interface FieldRendererProps {\n  fields: FieldConfig[];\n  state: FormState;\n  dispatch: React.Dispatch<FormAction>;\n}\n\nexport const FieldRenderer: React.FC<FieldRendererProps> = ({ fields, state, dispatch }) => {\n  return (\n    <>\n      {fields.map((field) => {\n        if (!evaluateVisibleIf(field.visibleIf, state)) {\n          return null;\n        }\n\n        const section = (field.section ?? 'setup') as keyof FormState['data'];\n        const value = (state.data[section] as Record<string, any>)[field.fieldId];\n\n        return (\n          <FormField\n            key={field.fieldId}\n            field={field}\n            state={state}\n            dispatch={dispatch}\n            value={value}\n          />\n        );\n      })}\n    </>\n  );\n};\n\nexport default FieldRenderer;\n====\nsrc/ui/components/fields/ConditionalField.tsx\nimport * as React from 'react';\nimport { View } from 'react-native';\nimport { FieldConfig, FormState, FormAction } from '@shared-types/form';\nimport FormField from './FormField';\nimport { evaluateVisibleIf } from '../../../utils/fieldVisibility';\n\ninterface ConditionalFieldProps {\n  field: FieldConfig;\n  state: FormState;\n  dispatch: React.Dispatch<FormAction>;\n}\n\nexport const ConditionalField: React.FC<ConditionalFieldProps> = ({ field, state, dispatch }) => {\n  // Gebruik de centrale util voor SSOT zichtbaarheid\n  const isVisible = evaluateVisibleIf(field.visibleIf, state);\n\n  if (!isVisible || !field.dependentField) {\n    return null;\n  }\n\n  const dependentField = field.dependentField;\n  const section = dependentField.section ?? 'setup';\n  const fieldValue = (state.data[section] as any)[dependentField.fieldId];\n\n  return (\n    <View style={{ marginTop: 10, paddingLeft: 15, borderLeftWidth: 2, borderLeftColor: '#eee' }}>\n      <FormField field={dependentField} state={state} dispatch={dispatch} value={fieldValue} />\n    </View>\n  );\n};\n\nexport default ConditionalField;\n====\nsrc/ui/screens/CSV/CsvUploadScreen.tsx (optioneel â€“ data-extractie)\nimport { getISOWeek } from '@domain/helpers/DateHydrator';\nimport * as React from 'react';\nimport {\n  View,\n  Text,\n  TouchableOpacity,\n  ScrollView,\n  TextInput,\n  Alert,\n  ActivityIndicator,\n} from 'react-native';\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\nimport { dataOrchestrator } from '@services/dataOrchestrator';\nimport * as TransactionService from '@services/transactionService';\nimport { useAppStyles } from '@ui/styles/useAppStyles';\nimport { DATA_KEYS } from '@domain/constants/datakeys'; // Toegevoegd voor de juiste mapping\nimport { Logger } from '@/adapters/audit/AuditLoggerAdapter';\n\ntype Props = {\n  onClose: () => void;\n  // We verwachten nu de volledige household members en de setup\n  members: any[];\n  setupData: any;\n};\n\nconst CsvUploadScreen: React.FC<Props> = ({ onClose, members, setupData }) => {\n  const insets = useSafeAreaInsets();\n  const { styles, colors } = useAppStyles();\n\n  const [csvText, setCsvText] = React.useState('');\n  const [isUploading, setIsUploading] = React.useState(false);\n\n  const handleUpload = async () => {\n    try {\n      setIsUploading(true);\n\n      // --- 1. DE NIEUWE WASSTRAAT (processAllData) ---\n      // We geven de bestaande members mee voor de privacy mapping\n      const result = dataOrchestrator.processAllData(members || [], csvText, setupData || {});\n\n      // Gebruik de DATA_KEYS om de gefilterde lokale data op te halen\n\n      const financeData = result.local[DATA_KEYS.FINANCE];\n\n      if (financeData.transactions.length === 0) {\n        Alert.alert('Fout', 'Geen geldige transacties gevonden. Controleer het formaat.');\n        setIsUploading(false);\n        return;\n      }\n\n      // --- 2. SAMENVATTING / SIGNALEN ---\n      const { summary: income, hasMissingCosts } = financeData;\n\n      let message =\n        `${financeData.transactions.length} transacties verwerkt.\\n\\n` +\n        `Inkomen bron: ${income.source}\\n` +\n        `Inkomen (centen): ${income.finalIncome}\\n\\n`;\n\n      if (income.isDiscrepancy) {\n        message +=\n          `âš ï¸ We zien een afwijkend inkomen tussen CSV en Setup.\\n` +\n          `Verschil: formatCurrency(x)\\n\\n`;\n      }\n\n      if (hasMissingCosts) {\n        message += `ðŸ  We vonden woonlasten in de CSV die niet in je setup stonden.\\n\\n`;\n      }\n\n      Alert.alert('Bevestig Upload', message + 'Wil je deze data opslaan?', [\n        { text: 'Annuleren', style: 'cancel', onPress: () => setIsUploading(false) },\n        {\n          text: 'Opslaan',\n          onPress: async () => {\n            // --- 3. (ANONIEM) RESEARCH PAYLOAD NAAR ANALYTICS ---\n            // Je kunt result.research direct doorsturen naar een API/n8n\n            Logger.info('Sending to research:', result.research);\n\n            // --- 4. OPSLAAN NAAR LOKALE STORAGE ---\n            for (const tx of financeData.transactions) {\n              await (TransactionService as any)._mockLocalSave({\n                date: tx.date,\n                amount: tx.amount,\n                description: tx.description, // Al geanonimiseerd door orchestrator\n                category: tx.category,\n                paymentMethod: 'pin',\n                weekNumber: getISOWeek(new Date(tx.date)),\n              });\n            }\n\n            setIsUploading(false);\n            Alert.alert('Succes', 'Je dashboard is bijgewerkt!', [\n              { text: 'OK', onPress: onClose },\n            ]);\n          },\n        },\n      ]);\n    } catch (e: any) {\n      setIsUploading(false);\n      Alert.alert('Fout', e?.message ?? 'Onbekende fout bij verwerken van CSV');\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.pageContainer}>\n        <ScrollView\n          contentContainerStyle={[styles.scrollContent, { paddingBottom: 120 + insets.bottom }]}\n        >\n          <Text style={styles.pageTitle}>Bankafschrift Importeren</Text>\n\n          <Text style={{ color: colors.textSecondary, marginBottom: 16 }}>\n            Plak hier je bank-export. Persoonsgegevens en IBANs worden automatisch geanonimiseerd.\n          </Text>\n\n          <TextInput\n            style={[styles.input, { height: 240, textAlignVertical: 'top', fontFamily: 'Courier' }]}\n            multiline\n            placeholder=\"Plak hier uw CSV regels...\"\n            value={csvText}\n            onChangeText={setCsvText}\n            editable={!isUploading}\n          />\n\n          <TouchableOpacity\n            style={[\n              styles.button,\n              {\n                marginTop: 16,\n                marginLeft: 0,\n                backgroundColor: isUploading ? colors.secondary : colors.primary,\n              },\n            ]}\n            onPress={handleUpload}\n            disabled={isUploading || !csvText.trim()}\n          >\n            {isUploading ? (\n              <ActivityIndicator color=\"#fff\" />\n            ) : (\n              <Text style={styles.buttonText}>Analyseer CSV</Text>\n            )}\n          </TouchableOpacity>\n        </ScrollView>\n      </View>\n    </View>\n  );\n};\n\nexport default CsvUploadScreen;\n===\nsrc/ui/screens/Wizard/pages/1setupHousehold.config.ts\n// ADR-02: Type-Safety via relatieve paden\nimport { FormState, WizardPageConfig } from '@shared-types/form';\nimport { DATA_KEYS } from '@domain/constants/registry';\nimport { UX_TOKENS } from '@domain/constants/registry';\n\n/**\n * ADR-04: UI Components zijn â€œdumbâ€.\n * De projector (WizardPage) haalt de teksten op via de tokens.\n */\nexport const setupHouseholdConfig: WizardPageConfig = {\n  pageId: DATA_KEYS.SETUP,\n  titleToken: UX_TOKENS.PAGES[DATA_KEYS.SETUP], // \"Huishouden opzetten\"\n  componentName: 'WizardPage',\n  fields: [\n    {\n      fieldId: 'aantalMensen', // De technische key in je state.data.setup\n      label: 'Totaal aantal bewoners (N)', // Of gebruik: labelToken: UX_TOKENS.FIELDS.TOTAL_MEMBERS\n      type: 'counter',\n      defaultValue: 1,\n      min: 1,\n      max: 20,\n    },\n    {\n      fieldId: 'aantalVolwassen',\n      label: 'Aantal volwassenen (M)',\n      type: 'counter',\n      defaultValue: 1,\n      min: 1,\n      // ADR-01: Businesslogica in UI niet toegestaan, maar view-logic wel\n      visibleIf: (state: FormState) => (state.data[DATA_KEYS.SETUP]?.aantalMensen || 0) > 0,\n      maxGetter: (state: FormState) => state.data[DATA_KEYS.SETUP]?.aantalMensen || 1,\n    },\n    {\n      fieldId: 'kinderenLabel',\n      label: 'Waarvan aantal kinderen (K)',\n      type: 'derived-label',\n      // ADR-03: Berekening op basis van de state\n      valueGetter: (state: FormState) => {\n        const n = state.data[DATA_KEYS.SETUP]?.aantalMensen || 0;\n        const m = state.data[DATA_KEYS.SETUP]?.aantalVolwassen || 0;\n        return Math.max(0, n - m);\n      },\n      visibleIf: (state: FormState) => {\n        const n = state.data[DATA_KEYS.SETUP]?.aantalMensen || 0;\n        const m = state.data[DATA_KEYS.SETUP]?.aantalVolwassen || 0;\n        return n > m;\n      },\n    },\n    {\n      fieldId: 'autoCount',\n      labelToken: UX_TOKENS.FIELDS.CAR_COUNT, // Werkt nu!\n      type: 'radio-chips',\n      options: [\n        { label: 'Geen', value: 'Nee' }, // Tip: gebruik 'Nee' ipv '0' als je visibleIf daarop checkt\n        { label: '1 auto', value: 'Een' },\n        { label: \"2+ auto's\", value: 'Twee' },\n      ],\n      defaultValue: 'Nee',\n    },\n    {\n      fieldId: 'heeftHuisdieren',\n      label: 'Zijn er huisdieren aanwezig?',\n      type: 'toggle',\n      defaultValue: false,\n    },\n  ],\n};\n====\nsrc/ui/screens/Wizard/pages/2detailsHousehold.config.ts\nimport { DATA_KEYS, SUB_KEYS } from '@domain/constants/registry';\nimport { UX_TOKENS } from '@domain/constants/registry';\nimport { WizardPageConfig } from '@shared-types/wizard';\n\nexport const detailsHouseholdConfig: WizardPageConfig = {\n  pageId: DATA_KEYS.HOUSEHOLD,\n  titleToken: UX_TOKENS.PAGES[DATA_KEYS.HOUSEHOLD], // Automatisch 'Wie zijn de bewoners?'\n  componentName: 'WizardPage',\n  fields: [\n    {\n      fieldId: SUB_KEYS.MEMBERS,\n      type: 'repeater',\n      fields: [\n        {\n          fieldId: 'fullName',\n          labelToken: UX_TOKENS.FIELDS.NAME, // 'Volledige naam'\n          type: 'text',\n          required: true,\n        },\n      ],\n    },\n  ],\n};\n====\nsrc/ui/screens/Wizard/pages/3incomeDetails.config.ts\nimport { FormState } from '@shared-types/form';\nimport { WizardPageConfig } from '@shared-types/wizard';\nimport { DATA_KEYS, SUB_KEYS } from '@domain/constants/registry';\nimport { UX_TOKENS } from '@domain/constants/registry';\n\nexport const incomeDetailsConfig: WizardPageConfig = {\n  // Gebruik de technische key voor consistentie\n  pageId: '3incomeDetails',\n  titleToken: UX_TOKENS.PAGES[DATA_KEYS.FINANCE], // Gebruikt \"Inkomsten & lasten\" uit labels.ts\n  componentName: 'WizardPage',\n\n  fields: [\n    {\n      // Dit zorgt dat de data onder state.data.finance.income terecht komt\n      fieldId: SUB_KEYS.INCOME,\n      label: 'Inkomen algemeen',\n      type: 'section',\n      fields: [\n        {\n          fieldId: 'work_salary',\n          label: 'Inkomen uit werk (â‚¬/mnd)',\n          type: 'money',\n        },\n      ],\n    },\n    {\n      // De repeater die over de bewoners loopt\n      fieldId: 'member_income_repeater',\n      label: 'Inkomen per gezinslid',\n      type: 'repeater',\n      // ADR-03: Filter de leden uit het juiste state-pad\n      filter: (state: FormState) => state.data[DATA_KEYS.HOUSEHOLD]?.members ?? [],\n      fields: [\n        {\n          fieldId: 'member_income_details',\n          type: 'section',\n          label: 'Inkomensspecificatie',\n          // Zorg dat we alleen iets tonen als er een memberId is (voor de context)\n          visibleIf: (state: FormState, context?: { memberId?: string }) => !!context?.memberId,\n          fields: [\n            {\n              fieldId: 'salary',\n              label: 'Salaris (â‚¬/mnd)',\n              type: 'money',\n            },\n            {\n              fieldId: 'benefits',\n              label: 'Uitkering/Toeslagen (â‚¬/mnd)',\n              type: 'money',\n            },\n          ],\n        },\n      ],\n    },\n  ],\n};\n====\nsrc/ui/screens/Wizard/pages/4fixedExpenses.config.ts\nimport { FormState } from '@shared-types/form';\nimport { WizardPageConfig } from '@shared-types/wizard';\nimport { DATA_KEYS, SUB_KEYS } from '@domain/constants/registry';\nimport { UX_TOKENS } from '@domain/constants/registry';\n\nexport const fixedExpensesConfig: WizardPageConfig = {\n  pageId: '4fixedExpenses',\n  titleToken: UX_TOKENS.PAGES[DATA_KEYS.FINANCE], // Gebruikt de 'Inkomsten & lasten' token\n  componentName: 'WizardPage',\n  fields: [\n    {\n      // We nesten dit onder EXPENSES voor de orchestrator\n      fieldId: SUB_KEYS.EXPENSES,\n      label: 'Wonen',\n      type: 'section',\n      fields: [\n        {\n          fieldId: 'living_costs',\n          label: 'Huur / Hypotheek (â‚¬/mnd)',\n          type: 'money',\n        },\n      ],\n    },\n    {\n      fieldId: 'car_repeater',\n      label: 'Vervoer (Auto)',\n      type: 'repeater',\n      // ADR-01: View-logic gebaseerd op de SETUP state\n      visibleIf: (state: FormState) => state.data[DATA_KEYS.SETUP]?.autoCount !== 'Nee',\n\n      // ADR-03: De repeater lengte wordt bepaald door de eerdere keuze\n      countGetter: (state: FormState) => {\n        const val = state.data[DATA_KEYS.SETUP]?.autoCount;\n        if (val === 'Een') return 1;\n        if (val === 'Twee') return 2;\n        return 0;\n      },\n      fields: [\n        { fieldId: 'car_fixed', label: 'Verzekering + Belasting', type: 'money' },\n        { fieldId: 'car_fuel', label: 'Brandstof / Laden', type: 'money' },\n      ],\n    },\n    {\n      fieldId: 'subscription_section',\n      label: 'Streaming & Abonnementen',\n      type: 'collapsible-section',\n      fields: [\n        { fieldId: 'netflix', label: 'Netflix', type: 'money' },\n        { fieldId: 'videoland', label: 'Videoland', type: 'money' },\n        { fieldId: 'hbo', label: 'HBO Max', type: 'money' },\n        { fieldId: 'disneyPlus', label: 'Disney+', type: 'money' },\n      ],\n    },\n  ],\n};\n====\nsrc/ui/screens/Wizard/WizardPage.tsx\nimport * as React from 'react';\nimport { View, Text, ScrollView, StyleSheet } from 'react-native';\nimport { useForm } from '@app/context/FormContext';\nimport FormField from '@components/fields/FormField';\nimport { WizardPageConfig, DataSection } from '@shared-types/form';\nimport { evaluateVisibleIf } from '../../../utils/fieldVisibility';\n\ninterface WizardPageProps {\n  config: WizardPageConfig;\n  onNext: () => void;\n  onBack: () => void;\n  isFirst: boolean;\n  isLast: boolean;\n}\n\nexport const WizardPage: React.FC<WizardPageProps> = ({ config }) => {\n  const { state, dispatch } = useForm();\n\n  return (\n    <View style={styles.container}>\n      {config.titleToken && <Text style={styles.title}>{config.titleToken}</Text>}\n      {config.title && <Text style={styles.title}>{config.title}</Text>}\n\n      <ScrollView style={styles.scrollContainer}>\n        {config.fields.map((field) => {\n          const targetSection: DataSection = field.section || config.section || 'setup';\n          const sectionData = state.data[targetSection];\n          const value = (sectionData as any)?.[field.fieldId];\n\n          // Gebruik de centrale util voor SSOT zichtbaarheid\n          if (!evaluateVisibleIf(field.visibleIf, state)) {\n            return null;\n          }\n\n          return (\n            <FormField\n              key={field.fieldId}\n              field={field}\n              state={state}\n              dispatch={dispatch}\n              value={value}\n            />\n          );\n        })}\n      </ScrollView>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: { flex: 1, padding: 16 },\n  title: { fontSize: 24, fontWeight: 'bold', marginBottom: 16 },\n  scrollContainer: { flex: 1 },\n});"
}