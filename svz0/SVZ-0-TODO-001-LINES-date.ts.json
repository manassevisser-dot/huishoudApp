{
  "Producing_Role": "CEO Manasse",
  "Artifact_ID": "SVZ-0-TODO-001-LINES-date.ts",
  "Status": "PENDING",
  "Token_ID": "TOKEN-ID-MANASSE-SVZ0-6AAEB31D",
  "Runtime_Environment": "NODE_TERMINAL",
  "SHA256_Hash": "6aaeb31d2d639365ed09b8abacb154305020c8737ece52b112a618ddc66dbd07",
  "Source_Commit": "MANUAL_CLI_INPUT",
  "PII_Attestation": "NEE - CLEAN",
  "File_Name": "date.ts",
  "Raw_Content": "// src/utils/date.ts\n\n/**\n * ===========================================\n *  Datumhulpen — TZ-robuust met lokale tijdzone\n * ===========================================\n * Richtlijnen:\n * - 'YYYY-MM-DD' (\"ISO zonder tijd\") wordt NIET via new Date(iso) geparsed,\n *   maar handmatig naar een lokale Date op 12:00 (lokale noon), om\n *   dagverschuivingen (UTC-midnight interpretatie) te voorkomen.\n * - Strings met tijd (bv. '2026-01-02T08:30:00Z') laat je bewust aan Date-API,\n *   omdat ze een expliciete tijdzone/offset dragen.\n */\n\n/* ======================================================================================\n *  Interne helpers voor ISO-datum (YYYY-MM-DD) ↔ lokale Date op 12:00 (noon)\n * ====================================================================================== */\n\n/** Herkent exact 'YYYY-MM-DD'. */\nfunction isIsoDateOnly(input: string): boolean {\n  return /^\\d{4}-\\d{2}-\\d{2}$/.test(input);\n}\n\n/** Geldigheidscheck van een Y/M/D kalenderdatum. */\nfunction isValidYMD(y: number, m: number, d: number): boolean {\n  if (!Number.isInteger(y) || !Number.isInteger(m) || !Number.isInteger(d)) return false;\n  const test = new Date(y, m - 1, d, 12, 0, 0, 0); // lokale noon\n  return test.getFullYear() === y && test.getMonth() === m - 1 && test.getDate() === d;\n}\n\n/**\n * Parse 'YYYY-MM-DD' naar een lokale Date op 12:00 (noon).\n * Retourneert null bij ongeldige kalenderdatum.\n */\nexport function isoDateOnlyToLocalNoon(iso: string): Date | null {\n  if (!isIsoDateOnly(iso)) return null;\n  const [yy, mm, dd] = iso.split('-').map(Number);\n  if (!isValidYMD(yy, mm, dd)) return null;\n  return new Date(yy, mm - 1, dd, 12, 0, 0, 0); // lokale noon\n}\n\n/**\n * Maak van een lokale Date (waarvan alleen de dag relevant is) een 'YYYY-MM-DD'.\n * Gebruikt locale componenten, dus geen TZ-drift.\n */\nexport function toISOFromLocal(dateLocal: Date): string {\n  const y = dateLocal.getFullYear();\n  const m = String(dateLocal.getMonth() + 1).padStart(2, '0');\n  const d = String(dateLocal.getDate()).padStart(2, '0');\n  return `${y}-${m}-${d}`;\n}\n\n/* ======================================================================================\n *  API: Parsen en formatteren\n * ====================================================================================== */\n\n/**\n * Parse DD-MM-YYYY string naar ISO-YYYY-MM-DD.\n * Valideert de kalenderdatum.\n */\nexport function parseDDMMYYYYtoISO(input: string): string | null {\n  const match = input.match(/^(\\d{2})-(\\d{2})-(\\d{4})$/);\n  if (!match) return null;\n  const [, dd, mm, yyyy] = match;\n  const day = Number(dd);\n  const month = Number(mm);\n  const year = Number(yyyy);\n  if (!isValidYMD(year, month, day)) return null;\n  // We willen een 'YYYY-MM-DD' string terug\n  const asLocal = new Date(year, month - 1, day, 12, 0, 0, 0);\n  return toISOFromLocal(asLocal);\n}\n\n/**\n * Format date object of ISO string naar verschillende weergaven:\n *   'dd-mm-yyyy' | 'weekday' | 'short' | 'full'\n *\n * - 'YYYY-MM-DD' wordt TZ-robuust behandeld via lokale noon.\n * - Strings met tijd laten we bewust aan new Date(...) (heeft al offset/context).\n * - Een Date blijft een Date.\n */\nexport function formatDate(\n  input: Date | string,\n  formatType: 'dd-mm-yyyy' | 'weekday' | 'short' | 'full' = 'dd-mm-yyyy',\n): string {\n  let date: Date;\n\n  if (typeof input === 'string' && isIsoDateOnly(input)) {\n    const local = isoDateOnlyToLocalNoon(input);\n    if (!local) return ''; // ongeldige string\n    date = local;\n  } else if (typeof input === 'string') {\n    // Date-time string (bv. ISO met tijdzone/offset)\n    const d = new Date(input);\n    if (isNaN(d.getTime())) return '';\n    date = d;\n  } else {\n    date = input;\n  }\n  if (!date || isNaN(date.getTime())) {\n    return '';\n  }\n  const options: Intl.DateTimeFormatOptions = {};\n\n  switch (formatType) {\n    case 'dd-mm-yyyy': {\n      // Gebruik lokale componenten voor consistente kalenderweergave\n      const dd = String(date.getDate()).padStart(2, '0');\n      const mm = String(date.getMonth() + 1).padStart(2, '0');\n      const yyyy = date.getFullYear();\n      return `${dd}-${mm}-${yyyy}`;\n    }\n    case 'weekday': {\n      options.weekday = 'short';\n      return date.toLocaleDateString('nl-NL', options);\n    }\n    case 'short': {\n      options.day = 'numeric';\n      options.month = 'short';\n      options.year = '2-digit';\n      return date.toLocaleDateString('nl-NL', options);\n    }\n    case 'full': {\n      options.weekday = 'long';\n      options.day = 'numeric';\n      options.month = 'long';\n      options.year = 'numeric';\n      return date.toLocaleDateString('nl-NL', options);\n    }\n    default:\n      return date.toLocaleDateString('nl-NL');\n  }\n}\n\n/**\n * Berekent leeftijd op basis van ISO string 'YYYY-MM-DD'.\n * Robuust tegen TZ en valideert invoer; geeft null bij ongeldige datum.\n */\nexport function calculateAge(iso: string): number | null {\n  if (typeof iso !== 'string' || !isIsoDateOnly(iso)) return null;\n  const d = isoDateOnlyToLocalNoon(iso);\n  if (!d) return null;\n\n  const y = d.getFullYear();\n  const m = d.getMonth() + 1;\n  const day = d.getDate();\n\n  const today = new Date();\n  let age = today.getFullYear() - y;\n\n  const mDiff = today.getMonth() + 1 - m;\n  if (mDiff < 0 || (mDiff === 0 && today.getDate() < day)) age--;\n\n  return age;\n}\n\n/* ======================================================================================\n *  Bestaande hulpen (ongewijzigde API, maar TZ-bewust waar zinvol)\n * ====================================================================================== */\n\n/** ISO 'YYYY-MM-DD' uit een Date (lokale kalenderdag). */\nexport function formatDateISO(date: Date): string {\n  return toISOFromLocal(date);\n}\n\n/** Huidige lokale kalenderdag als 'YYYY-MM-DD'. */\nexport function getCurrentDateISO(): string {\n  return toISOFromLocal(new Date());\n}\n\n/**\n * ISO weeknummer (ISO-8601).\n * We rekenen in lokale tijd (standaard JS Date), wat in NL/EU doorgaans gewenst is.\n */\nexport function getISOWeek(date: Date): number {\n  const d = new Date(date.getTime());\n  d.setHours(0, 0, 0, 0);\n  // donderdag als anker (ISO): 4 - (day||7)\n  d.setDate(d.getDate() + 4 - (d.getDay() || 7));\n  const yearStart = new Date(d.getFullYear(), 0, 1);\n  const weekNo = Math.ceil(((d.getTime() - yearStart.getTime()) / 86400000 + 1) / 7);\n  return weekNo;\n}\n\n/**\n * Snelle plausibiliteitscheck voor 'DDMMYYYY' strings (zonder separators).\n * Let op: valideert NIET de exacte kalenderdag (bv. 31/02 gaat hier door);\n * gebruik daarna parseDDMMYYYYtoISO voor kalender-validatie.\n */\nexport function isDigitsDatePlausible(digits: string): boolean {\n  if (digits.length !== 8) return false;\n  const dd = Number(digits.slice(0, 2));\n  const mm = Number(digits.slice(2, 4));\n  const yyyy = Number(digits.slice(4, 8));\n  if (!Number.isInteger(dd) || !Number.isInteger(mm) || !Number.isInteger(yyyy)) return false;\n  if (dd < 1 || dd > 31) return false;\n  if (mm < 1 || mm > 12) return false;\n  if (yyyy < 1900 || yyyy > 2099) return false;\n  return true;\n}\n\n/* ======================================================================================\n *  Grenzen t.o.v. vandaag (LOKALE noon) voor DOB (Age gates)\n * ====================================================================================== */\n\n/** Vandaag op 12:00 lokale tijd (noon), om TZ/DST-dagverschuivingen te voorkomen. */\nexport function todayLocalNoon(): Date {\n  const now = new Date();\n  return new Date(now.getFullYear(), now.getMonth(), now.getDate(), 12, 0, 0, 0);\n}\n\n/** YYYY-MM-DD uit een lokale Date (zonder tijdcomponenten). */\nexport function toISOFromLocalNoon(dateLocalNoon: Date): string {\n  return toISOFromLocal(dateLocalNoon);\n}\n\n/** Max DOB voor VOLWASSENE: vandaag - 18 jaar (lokale noon). */\nexport function getAdultMaxISO(base?: Date): string {\n  const baseLocal = base ?? todayLocalNoon();\n  const d = new Date(baseLocal);\n  d.setFullYear(d.getFullYear() - 18);\n  return toISOFromLocalNoon(d);\n}\n\n/** Min DOB voor KIND: (vandaag - 18 jaar) + 1 dag (voorkomt exact 18). */\nexport function getChildMinISO(base?: Date): string {\n  const baseLocal = base ?? todayLocalNoon();\n  const d = new Date(baseLocal);\n  d.setFullYear(d.getFullYear() - 18);\n  d.setDate(d.getDate() + 1);\n  return toISOFromLocalNoon(d);\n}\n\n/** Max DOB voor KIND: vandaag (lokale noon). */\nexport function getChildMaxISO(base?: Date): string {\n  return toISOFromLocalNoon(base ?? todayLocalNoon());\n}\n"
}