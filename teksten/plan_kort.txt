Het plan â€” vanuit de noodzaak van de mislukte refactor
De huidige wizardâ€‘app is instabiel geraakt omdat de eerdere refactor halverwege is blijven steken. Hierdoor zitten logica, validatie en UIâ€‘weergave nu door elkaar, waardoor:

velden niet meer goed zichtbaar zijn of verdwijnen,
validatie onvoorspelbaar werkt,
de wizard state inconsistent is,
tests niet kloppen of helemaal ontbreken,
fixes in de ene plek iets anders breken,
uitbreiden vrijwel onmogelijk is.

Daarom moet het project opnieuw, maar dit keer gestructureerd worden opgebouwd.

ğŸ¯ Kern van het plan
1ï¸âƒ£ Domeinlogica moet uit de UI
Momenteel zit businessâ€‘logica (visibility, berekeningen, validatie) verspreid door UIâ€‘componenten.
Dat maakt het ontestbaar, foutgevoelig en onmogelijk te migreren.
Plan:

Alle businessâ€‘regels verhuizen naar Ã©Ã©n centrale domainâ€‘laag (pure functies, voorspelbaar, testbaar).


2ï¸âƒ£ Er moet een duidelijke scheiding komen tussen:

Domain (regels, validatie, visibility, berekeningen)
App (FormState, orchestrators, adapters, ValueProvider)
UI (dumb components + config)

Nu lopen deze drie lagen volledig door elkaar. Dat is precies waarom de refactor stukging.
Plan:

Domain wordt â€œzuiverâ€
Appâ€‘laag krijgt Ã©Ã©n verantwoordelijkheid: state beheren en domain aansturen
UI verwacht alleen props en configs, geen logica


3ï¸âƒ£ Configâ€‘bestanden moeten leidend worden
De wizardâ€‘paginaâ€™s moeten volledig configâ€‘gedreven werken.
Nu zit er nog logica in:

WizardPage
FieldRenderer
.config.ts files
losse componenten

Plan:

Config bestanden bevatten alleen data (velden, labels, types)
Domain bepaalt:

zichtbaarheid
constraints
berekeningen


UI rendert alleen wat je opgeeft


4ï¸âƒ£ Velden moeten via Ã©Ã©n consistent systeem worden opgehaald
Na de mislukte refactor zijn er:

twee verschillende ValueProviders
meerdere manieren om dingen uit state te lezen
inconsistent pathâ€‘gebruik voor velden

Plan:

Ã‰Ã©n FieldPathResolver
Ã‰Ã©n ValueProvider
EÃ©n FormStateValueProvider adapter
â†’ zodat elk veld voorspelbaar werkt.


5ï¸âƒ£ Validatie moet gecentraliseerd en volledig testbaar worden
Nu is validatie verspreid en deels kapot.
Sommige velden hebben min/max op root, andere in validation, sommige nergens.
Plan:

EÃ©n domeinvalidator
EÃ©n bron van waarheid voor regels
Snapshotâ€‘tests om bestaand gedrag vast te leggen
Daarna uitbreiden met veilige, gecontroleerde wijzigingen


6ï¸âƒ£ De wizard flow moet weer betrouwbaar worden
Omdat de huidige flow afhankelijk is van incomplete configuraties en uit elkaar gevallen orchestrators, werkt de wizard niet meer stabiel.
Plan:

Appâ€‘laag herstructureren (FormStateOrchestrator)
Wizard moet state ontvangen uit appâ€‘laag, niet meer zelf puzzelen
Geen logica in WizardPage of FieldRenderer


7ï¸âƒ£ Testen moeten opnieuw worden opgebouwd
Je hebt nu Â±1,14% coverage â€” vrijwel niets werkt nog.
Plan:

Nieuwe domainâ€‘testen
Nieuwe appâ€‘laag integratietesten
UIâ€‘renderingâ€‘testen zonder logica
Baselines om bestaand gedrag vast te leggen (belangrijk voor vertrouwen)


ğŸ Het eindresultaat
Wanneer dit plan is uitgevoerd:

De app werkt weer stabiel
Businesslogica zit volledig in domain
UI is clean, simpel, uitbreidbaar
Wizard werkt consistent per stap
Validatie en zichtbaarheid zijn voorspelbaar
Nieuwe features toevoegen is veilig
Je hebt volledige testdekking en snapshots
Je weet zeker dat refactoren niet weer alles breekt

