==== FILE: ./src/ui/components/FieldRenderer.tsx ====
import * as React from 'react';
import { FieldConfig, FormState, FormAction } from '@shared-types/form';
import FormField from '@fields/FormField';
import { evaluateVisibleIf } from '../../utils/fieldVisibility';

export interface FieldRendererProps {
  fields: FieldConfig[];
  state: FormState;
  dispatch: React.Dispatch<FormAction>;
}

export const FieldRenderer: React.FC<FieldRendererProps> = ({ fields, state, dispatch }) => {
  return (
    <>
      {fields.map((field) => {
        if (!evaluateVisibleIf(field.visibleIf, state)) {
          return null;
        }

        const section = (field.section ?? 'setup') as keyof FormState['data'];
        const value = (state.data[section] as Record<string, any>)[field.fieldId];

        return (
          <FormField
            key={field.fieldId}
            field={field}
            state={state}
            dispatch={dispatch}
            value={value}
          />
        );
      })}
    </>
  );
};

export default FieldRenderer;==== FILE: ./src/ui/components/fields/ChipButton.tsx ====
import * as React from 'react';
import { TouchableOpacity, Text } from 'react-native';
import { useAppStyles } from '@ui/styles/useAppStyles';

export type ChipButtonProps = {
  label: string;
  selected: boolean;
  error?: boolean;
  onPress: () => void;
  accessibilityLabel?: string;
};

const ChipButton: React.FC<ChipButtonProps> = ({
  label,
  selected,
  error,
  onPress,
  accessibilityLabel,
}) => {
  const { styles, _colors } = useAppStyles() as any;

  return (
    <TouchableOpacity
      style={[styles.chip, selected && styles.chipSelected, error && styles.chipError]}
      onPress={onPress}
      accessibilityRole="button"
      accessibilityLabel={accessibilityLabel ?? label}
      accessibilityState={{ selected }}
    >
      <Text style={[styles.chipText, selected && styles.chipTextSelected]}>{label}</Text>
    </TouchableOpacity>
  );
};

export default ChipButton;
==== FILE: ./src/ui/components/fields/ConditionalField.tsx ====
import * as React from 'react';
import { View } from 'react-native';
import { FieldConfig, FormState, FormAction } from '@shared-types/form';
import FormField from './FormField';
import { evaluateVisibleIf } from '../../../utils/fieldVisibility';

interface ConditionalFieldProps {
  field: FieldConfig;
  state: FormState;
  dispatch: React.Dispatch<FormAction>;
}

export const ConditionalField: React.FC<ConditionalFieldProps> = ({ field, state, dispatch }) => {
  // Gebruik de centrale util voor SSOT zichtbaarheid
  const isVisible = evaluateVisibleIf(field.visibleIf, state);

  if (!isVisible || !field.dependentField) {
    return null;
  }

  const dependentField = field.dependentField;
  const section = dependentField.section ?? 'setup';
  const fieldValue = (state.data[section] as any)[dependentField.fieldId];

  return (
    <View style={{ marginTop: 10, paddingLeft: 15, borderLeftWidth: 2, borderLeftColor: '#eee' }}>
      <FormField field={dependentField} state={state} dispatch={dispatch} value={fieldValue} />
    </View>
  );
};

export default ConditionalField;==== FILE: ./src/ui/components/fields/DateField.tsx ====
import { formatDate } from '@ui/helpers/dateFormatting';
import * as React from 'react';
import { Platform, View, Text, Pressable } from 'react-native';
import DateTimePicker, { DateTimePickerEvent } from '@react-native-community/datetimepicker';
import { useAppStyles } from '@ui/styles/useAppStyles';

type Props = {
  label: string;
  valueISO?: string; // canoniek: 'YYYY-MM-DD'
  onChangeISO: (iso: string | undefined) => void;
  minISO?: string; // default: '1920-01-01'
  maxISO?: string; // default: vandaag
  errorText?: string | null;
  accessibilityLabel?: string;
};

const isoToDate = (iso?: string): Date => {
  if (!iso) return new Date();
  const [y, m, d] = iso.split('-').map(Number);
  // UTC noon voorkomt dagverschuiving door tijdzones
  return new Date(Date.UTC(y, (m ?? 1) - 1, d ?? 1, 12, 0, 0));
};

const isoToday = (): string => {
  const now = new Date();
  const y = now.getFullYear();
  const m = String(now.getMonth() + 1).padStart(2, '0');
  const d = String(now.getDate()).padStart(2, '0');
  return `${y}-${m}-${d}`;
};

const dateToISO = (dt: Date): string => {
  // Niet toISOString(); dat geeft TZ issues. Formatteer zelf naar YYYY-MM-DD (UTC)
  const y = dt.getUTCFullYear();
  const m = String(dt.getUTCMonth() + 1).padStart(2, '0');
  const d = String(dt.getUTCDate()).padStart(2, '0');
  return `${y}-${m}-${d}`;
};

const DateField: React.FC<Props> = ({
  label,
  valueISO,
  onChangeISO,
  minISO = '1920-01-01',
  maxISO,
  errorText,
  accessibilityLabel,
}) => {
  const { styles, colors } = useAppStyles() as any;
  const [show, setShow] = React.useState(false);

  const max = maxISO ?? isoToday();
  const display = valueISO ? formatDate(valueISO, 'dd-mm-yyyy') : '';

  return (
    <View style={styles.fieldContainer}>
      <Text style={styles.fieldLabel}>{label}</Text>

      <Pressable
        onPress={() => setShow(true)}
        accessibilityRole="button"
        accessibilityLabel={accessibilityLabel ?? label}
        style={[styles.input, { justifyContent: 'center' }, errorText && styles.inputError]}
      >
        <Text style={{ color: display ? colors.textPrimary : colors.textSecondary }}>
          {display || 'DD-MM-YYYY'}
        </Text>
      </Pressable>

      {show && (
        <DateTimePicker
          mode="date"
          value={valueISO ? isoToDate(valueISO) : isoToDate(max)}
          minimumDate={isoToDate(minISO)}
          maximumDate={isoToDate(max)}
          display={Platform.OS === 'ios' ? 'spinner' : 'calendar'}
          onChange={(event: DateTimePickerEvent, date?: Date) => {
            if (Platform.OS === 'android') setShow(false);
            if (event.type === 'dismissed') return;
            if (!date) return;
            const iso = dateToISO(date);
            onChangeISO(iso);
          }}
        />
      )}

      {errorText && <Text style={styles.errorTextStyle}>{errorText}</Text>}
    </View>
  );
};

export default DateField;
==== FILE: ./src/ui/components/fields/FormField.tsx ====
import React from 'react';
import { View } from 'react-native';
import { FormState, FormAction } from '@shared-types/form';
import InputCounter from './InputCounter';
import ToggleSwitch from './ToggleSwitch';
import { FieldConfig } from '@shared-types/fields';

interface FormFieldProps {
  field: FieldConfig;
  state: FormState;
  dispatch: React.Dispatch<FormAction>;
  value: any;
}

const FormField: React.FC<FormFieldProps> = ({ field, dispatch, value }) => {
  const targetSection = field.section ?? 'setup';

  const handleChange = (newValue: any) => {
    dispatch({
      type: 'SET_FIELD',
      payload: { section: targetSection, field: field.fieldId, value: newValue },
    });
  };

  return (
    <View>
      {field.type === 'counter' && (
        <InputCounter
          fieldId={field.fieldId}
          label={field.label || field.labelToken}
          value={Number(value || 0)}
          onChange={(p) => handleChange(p.value)}
          min={field.validation?.min}
          max={field.validation?.max}
        />
      )}
      {field.type === 'toggle' && (
        <ToggleSwitch value={!!value} onToggle={() => handleChange(!value)} />
      )}
      {/* Voeg hier DateField en MoneyInput toe op dezelfde wijze */}
    </View>
  );
};

export default FormField;
==== FILE: ./src/ui/components/fields/InputCounter.tsx ====
import * as React from 'react';
import { View, Text, TouchableOpacity } from 'react-native';

/** Phoenix-only props */
export type InputCounterProps = {
  label?: string;
  fieldId: string;
  value: number;
  min?: number;
  max?: number;
  disabled?: boolean;
  testIdBase?: string;
  onChange: (payload: { fieldId: string; value: number }) => void;
};

const InputCounter: React.FC<InputCounterProps> = ({
  label,
  fieldId,
  value,
  min = 0,
  max = 100,
  disabled,
  testIdBase = 'counter',
  onChange,
}) => {
  const emit = (next: number) => onChange({ fieldId, value: next });
  const dec = () => emit(Math.max(min, value - 1));
  const inc = () => emit(Math.min(max, value + 1));

  return (
    <View
      style={{
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        padding: 10,
      }}
    >
      {label ? <Text>{label}</Text> : null}
      <View style={{ flexDirection: 'row', alignItems: 'center' }}>
        <TouchableOpacity
          testID={`${testIdBase}-decrement`}
          accessibilityRole="button"
          accessibilityLabel="Verlagen"
          onPress={dec}
          disabled={disabled || value <= min}
        >
          <Text style={{ fontSize: 25 }}> - </Text>
        </TouchableOpacity>

        <Text
          testID={`${testIdBase}-value`}
          accessibilityLabel={`Huidige waarde ${value}`}
          style={{ marginHorizontal: 15 }}
        >
          {value}
        </Text>

        <TouchableOpacity
          testID={`${testIdBase}-increment`}
          accessibilityRole="button"
          accessibilityLabel="Verhogen"
          onPress={inc}
          disabled={disabled || value >= max}
        >
          <Text style={{ fontSize: 25 }}> + </Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};

export default InputCounter;
==== FILE: ./src/ui/components/fields/MoneyField.tsx ====
import * as React from 'react';
import { View, Text, TextInput } from 'react-native';

export interface MoneyFieldProps {
  label: string;
  amount: number; // We gebruiken 'amount' zoals geÃ«ist door de compiler in DailyInput
  onAmountChange: (val: number) => void;
  error?: string;
}

export const MoneyField: React.FC<MoneyFieldProps> = ({ label, amount, onAmountChange, error }) => {
  return (
    <View style={{ marginBottom: 15 }}>
      <Text style={{ fontWeight: '600', marginBottom: 5 }}>{label}</Text>
      <TextInput
        style={{
          borderWidth: 1,
          borderColor: error ? 'red' : '#ccc',
          padding: 12,
          borderRadius: 8,
          fontSize: 18,
        }}
        keyboardType="numeric"
        value={amount.toString()}
        onChangeText={(text) => {
          const num = parseFloat(text.replace(',', '.'));
          onAmountChange(isNaN(num) ? 0 : num);
        }}
        placeholder="0.00"
      />
      {error && <Text style={{ color: 'red', fontSize: 12 }}>{error}</Text>}
    </View>
  );
};
export default MoneyField;
==== FILE: ./src/ui/components/fields/MoneyInput.tsx ====
import * as React from 'react';
import { View, Text, TextInput } from 'react-native';
import { useAppStyles } from '@ui/styles/useAppStyles';
import { toCents, formatCentsToDutch, formatDutchValue } from '@domain/helpers/numbers';

type MoneyInputProps = {
  value: number; // Bedrag in centen (altijd >= 0)
  onValueChange: (cents: number) => void;
  disabled?: boolean;
  placeholder?: string;
  accessibilityLabel?: string;
};

const MoneyInput: React.FC<MoneyInputProps> = ({
  value,
  onValueChange,
  disabled = false,
  placeholder = '',
  accessibilityLabel = 'Bedrag',
}) => {
  const { styles } = useAppStyles();

  // De lokale staat houdt de string vast die de gebruiker ziet
  const [localValue, setLocalValue] = React.useState<string>(formatCentsToDutch(value));

  // Sync lokale staat als de externe waarde (centen) wijzigt
  React.useEffect(() => {
    setLocalValue(formatCentsToDutch(value));
  }, [value]);

  // Bij focus: verwijder duizendtal-punten voor makkelijk bewerken
  const onFocus = () => setLocalValue(formatDutchValue(localValue));

  // Tijdens typen: saniteer direct (geen letters, geen minus)
  const onChangeText = (text: string) => setLocalValue(formatDutchValue(text));

  // Bij blur: bereken centen en formatteer naar NL-standaard
  const onBlur = () => {
    const cents = toCents(localValue);
    onValueChange(cents); // Emit positieve centen naar de state
    setLocalValue(formatCentsToDutch(cents)); // "On-blur formatting"
  };

  return (
    <View style={styles.inputMoneyRow}>
      {/* Vast, niet-bewerkbaar prefix  */}
      <Text style={styles.moneyPrefix} accessibilityLabel="Euro-teken">
        â‚¬
      </Text>

      <TextInput
        value={localValue}
        onChangeText={onChangeText}
        onFocus={onFocus}
        onBlur={onBlur}
        placeholder={placeholder}
        editable={!disabled}
        accessibilityLabel={accessibilityLabel}
        keyboardType="decimal-pad" // Forceert numeriek pad op mobile
        style={styles.moneyTextInput}
      />
    </View>
  );
};

export default MoneyInput;
==== FILE: ./src/ui/components/fields/ToggleSwitch.tsx ====
import * as React from 'react';
import { View, TouchableOpacity, Text } from 'react-native';
import { useAppStyles } from '@ui/styles/useAppStyles';

export type ToggleSwitchProps = {
  value: boolean;
  onToggle: () => void;
  labelTrue?: string;
  labelFalse?: string;
  accessibilityLabel?: string;
};

const ToggleSwitch: React.FC<ToggleSwitchProps> = ({
  value,
  onToggle,
  labelTrue = 'Ja',
  labelFalse = 'Nee',
  accessibilityLabel,
}) => {
  const { styles, _colors } = useAppStyles() as any;

  return (
    <View style={styles.toggleWrapper}>
      <TouchableOpacity
        style={[styles.toggleButton, value ? styles.toggleActive : styles.toggleInactive]}
        onPress={onToggle}
        accessibilityRole="switch"
        accessibilityLabel={accessibilityLabel}
        accessibilityState={{ checked: value }}
      >
        <Text style={styles.toggleText}>{value ? labelTrue : labelFalse}</Text>
      </TouchableOpacity>
    </View>
  );
};

export default ToggleSwitch;
==== FILE: ./src/ui/components/FinancialSummary.tsx ====
import * as React from 'react';
import { View, Text } from 'react-native';
import { useAppStyles } from '@ui/styles/useAppStyles';
import { formatCurrency } from '@domain/helpers/numbers'; // Gebruik je nieuwe financiÃ«le grondwet

// Definieer een interface voor de data die de selector levert
interface FinancialSummaryData {
  totalIncomeCents: number;
  totalExpensesCents: number;
  netCents: number;
}

interface Props {
  data: FinancialSummaryData;
}

export const FinancialSummary: React.FC<Props> = ({ data }) => {
  const { styles, colors, Tokens } = useAppStyles();

  // We gebruiken de data direct uit de lades, omgezet naar Euro's voor display
  const incomeDisplay = formatCurrency(data.totalIncomeCents);
  const expensesDisplay = formatCurrency(data.totalExpensesCents);
  const netDisplay = formatCurrency(data.netCents);

  return (
    <View style={styles.summaryDetail}>
      <Text style={styles.pageTitle}>Financieel Overzicht</Text>

      {/* Totaal Inkomsten */}
      <View style={styles.summaryRow}>
        <Text style={styles.summaryLabel}>Totaal Inkomsten:</Text>
        <Text style={[styles.summaryValue, { color: colors.success, fontWeight: '700' }]}>
          {incomeDisplay}
        </Text>
      </View>

      {/* Totaal Uitgaven */}
      <View style={styles.summaryRow}>
        <Text style={styles.summaryLabel}>Totaal Uitgaven:</Text>
        <Text style={[styles.summaryValue, { color: colors.error, fontWeight: '700' }]}>
          {expensesDisplay}
        </Text>
      </View>

      {/* Netto resultaat */}
      <View style={styles.summaryRowTotal}>
        <Text style={styles.summaryLabelBold}>Netto resultaat:</Text>
        <Text style={styles.summaryValueBold}>{netDisplay}</Text>
      </View>

      <View style={{ height: Tokens.Space.md }} />
    </View>
  );
};
==== FILE: ./src/ui/navigation/MainNavigator.tsx ====
import React from 'react';
import { useForm } from '@app/context/FormContext';
import LandingScreen from '../screens/Wizard/LandingScreen';
import WizardController from '../screens/Wizard/WizardController';
import DashboardScreen from '../screens/Dashboard/DashboardScreen';

const MainNavigator = () => {
  const { state } = useForm();

  // Bepaal welk scherm getoond moet worden op basis van de globale state
  switch (state.activeStep) {
    case 'WIZARD':
      return <WizardController />;
    case 'DASHBOARD':
      return <DashboardScreen />;
    case 'LANDING':
    default:
      return <LandingScreen />;
  }
};

export default MainNavigator;
==== FILE: ./src/ui/screens/CSV/CsvUploadScreen.tsx ====
import { getISOWeek } from '@domain/helpers/DateHydrator';
import * as React from 'react';
import {
  View,
  Text,
  TouchableOpacity,
  ScrollView,
  TextInput,
  Alert,
  ActivityIndicator,
} from 'react-native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { dataOrchestrator } from '@services/dataOrchestrator';
import * as TransactionService from '@services/transactionService';
import { useAppStyles } from '@ui/styles/useAppStyles';
import { DATA_KEYS } from '@domain/constants/datakeys'; // Toegevoegd voor de juiste mapping
import { Logger } from '@/adapters/audit/AuditLoggerAdapter';

type Props = {
  onClose: () => void;
  // We verwachten nu de volledige household members en de setup
  members: any[];
  setupData: any;
};

const CsvUploadScreen: React.FC<Props> = ({ onClose, members, setupData }) => {
  const insets = useSafeAreaInsets();
  const { styles, colors } = useAppStyles();

  const [csvText, setCsvText] = React.useState('');
  const [isUploading, setIsUploading] = React.useState(false);

  const handleUpload = async () => {
    try {
      setIsUploading(true);

      // --- 1. DE NIEUWE WASSTRAAT (processAllData) ---
      // We geven de bestaande members mee voor de privacy mapping
      const result = dataOrchestrator.processAllData(members || [], csvText, setupData || {});

      // Gebruik de DATA_KEYS om de gefilterde lokale data op te halen

      const financeData = result.local[DATA_KEYS.FINANCE];

      if (financeData.transactions.length === 0) {
        Alert.alert('Fout', 'Geen geldige transacties gevonden. Controleer het formaat.');
        setIsUploading(false);
        return;
      }

      // --- 2. SAMENVATTING / SIGNALEN ---
      const { summary: income, hasMissingCosts } = financeData;

      let message =
        `${financeData.transactions.length} transacties verwerkt.\n\n` +
        `Inkomen bron: ${income.source}\n` +
        `Inkomen (centen): ${income.finalIncome}\n\n`;

      if (income.isDiscrepancy) {
        message +=
          `âš ï¸ We zien een afwijkend inkomen tussen CSV en Setup.\n` +
          `Verschil: formatCurrency(x)\n\n`;
      }

      if (hasMissingCosts) {
        message += `ðŸ  We vonden woonlasten in de CSV die niet in je setup stonden.\n\n`;
      }

      Alert.alert('Bevestig Upload', message + 'Wil je deze data opslaan?', [
        { text: 'Annuleren', style: 'cancel', onPress: () => setIsUploading(false) },
        {
          text: 'Opslaan',
          onPress: async () => {
            // --- 3. (ANONIEM) RESEARCH PAYLOAD NAAR ANALYTICS ---
            // Je kunt result.research direct doorsturen naar een API/n8n
            Logger.info('Sending to research:', result.research);

            // --- 4. OPSLAAN NAAR LOKALE STORAGE ---
            for (const tx of financeData.transactions) {
              await (TransactionService as any)._mockLocalSave({
                date: tx.date,
                amount: tx.amount,
                description: tx.description, // Al geanonimiseerd door orchestrator
                category: tx.category,
                paymentMethod: 'pin',
                weekNumber: getISOWeek(new Date(tx.date)),
              });
            }

            setIsUploading(false);
            Alert.alert('Succes', 'Je dashboard is bijgewerkt!', [
              { text: 'OK', onPress: onClose },
            ]);
          },
        },
      ]);
    } catch (e: any) {
      setIsUploading(false);
      Alert.alert('Fout', e?.message ?? 'Onbekende fout bij verwerken van CSV');
    }
  };

  return (
    <View style={styles.container}>
      <View style={styles.pageContainer}>
        <ScrollView
          contentContainerStyle={[styles.scrollContent, { paddingBottom: 120 + insets.bottom }]}
        >
          <Text style={styles.pageTitle}>Bankafschrift Importeren</Text>

          <Text style={{ color: colors.textSecondary, marginBottom: 16 }}>
            Plak hier je bank-export. Persoonsgegevens en IBANs worden automatisch geanonimiseerd.
          </Text>

          <TextInput
            style={[styles.input, { height: 240, textAlignVertical: 'top', fontFamily: 'Courier' }]}
            multiline
            placeholder="Plak hier uw CSV regels..."
            value={csvText}
            onChangeText={setCsvText}
            editable={!isUploading}
          />

          <TouchableOpacity
            style={[
              styles.button,
              {
                marginTop: 16,
                marginLeft: 0,
                backgroundColor: isUploading ? colors.secondary : colors.primary,
              },
            ]}
            onPress={handleUpload}
            disabled={isUploading || !csvText.trim()}
          >
            {isUploading ? (
              <ActivityIndicator color="#fff" />
            ) : (
              <Text style={styles.buttonText}>Analyseer CSV</Text>
            )}
          </TouchableOpacity>
        </ScrollView>
      </View>
    </View>
  );
};

export default CsvUploadScreen;
==== FILE: ./src/ui/screens/DailyInput/DailyInputScreen.tsx ====
import * as React from 'react';
import { View, ScrollView } from 'react-native';
import { MoneyField } from '@components/fields/MoneyField';
import { useAppStyles } from '@styles/useAppStyles';

// We gebruiken relatieve paden om alias-conflicten te vermijden
export const DailyInputScreen: React.FC = () => {
  const { styles } = useAppStyles();

  return (
    <ScrollView style={styles.container}>
      <View style={{ padding: 20 }}>
        <MoneyField
          label="Bedrag"
          // MoneyField verwacht 'amount' ipv 'value' op basis van je error
          amount={0}
          onAmountChange={(_val) => {
            /* logged via orchestrator */
          }}
        />
      </View>
    </ScrollView>
  );
};

export default DailyInputScreen;
==== FILE: ./src/ui/screens/Daily/UndoScreen.tsx ====
// src/ui/screens/Daily/UndoScreen.tsx
import React from 'react';
import { View, Text, TouchableOpacity, ScrollView } from 'react-native';
import { useTransactionHistory } from '@app/hooks/useTransactionHistory';
import { useAppStyles } from '@ui/styles/useAppStyles';

/**
 * UndoScreen - Transaction Management UI
 *
 * @architecture
 * - ADR-01 (SoC): Alleen presentatie logica, geen business rules
 * - ADR-04 (Dumb UI): Pure projector component (State in â†’ View uit)
 */
export const UndoScreen: React.FC = () => {
  const { styles } = useAppStyles();
  const { transactions, undo, redo, clearAll, updateTransaction, error, _debugAdapterState } =
    useTransactionHistory();

  const safeTransactions = Array.isArray(transactions) ? transactions : [];

  return (
    <ScrollView style={styles.container}>
      <View style={styles.content}>
        <Text style={styles.title}>Transaction Undo/Redo</Text>
        {!!error && <Text style={styles.error}>{error}</Text>}
        <View style={styles.section}>
          <Text style={styles.subtitle}>Laatste transacties: {safeTransactions.length}</Text>
          {safeTransactions.length === 0 ? (
            <Text style={styles.emptyText}>Geen recente transacties</Text>
          ) : (
            <View style={styles.dashboardCard}>
              {' '}
              {/* Gebruik bestaande card als container */}
              {safeTransactions.map((tx) => (
                <View key={tx.id} style={{ paddingVertical: 8 }}>
                  <Text style={styles.description}>{tx.description}</Text>
                  <Text style={styles.details}>
                    {tx.currency} {(tx.amount / 100).toFixed(2)} â€¢ {tx.date}
                  </Text>
                </View>
              ))}
            </View>
          )}
          <View style={{ flexDirection: 'row', gap: 8, marginTop: 16 }}>
            <TouchableOpacity
              onPress={undo}
              style={styles.button}
              testID="undo-button"
              disabled={!undo}
            >
              <Text style={styles.buttonText}>Undo</Text>
            </TouchableOpacity>
            <TouchableOpacity
              onPress={redo}
              style={styles.button}
              testID="redo-button"
              disabled={!redo}
            >
              <Text style={styles.buttonText}>Redo</Text>
            </TouchableOpacity>
            {safeTransactions.length > 0 && (
              <TouchableOpacity
                onPress={clearAll}
                accessibilityRole="button"
                accessibilityLabel="Verwijder Alles"
                testID="delete-all-button"
                style={[styles.button, styles.deleteButton]}
                disabled={!clearAll}
              >
                <Text style={styles.buttonText}>Verwijder Alles</Text>
              </TouchableOpacity>
            )}
          </View>
          {/* Debug Section â€” alleen buiten tests */}
          {process.env.NODE_ENV !== 'test' && _debugAdapterState && (
            <View style={styles.dashboardCard}>
              <Text style={styles.subtitle}>Debug Info</Text>
              <Text style={styles.details}>{JSON.stringify(_debugAdapterState, null, 2)}</Text>
              <TouchableOpacity
                onPress={() => updateTransaction && updateTransaction(100.5, 2)}
                style={{ marginTop: 12 }}
                testID="float-test-button"
                disabled={!updateTransaction}
              >
                <Text style={styles.navigationHint}>Test Float Violation (100.5)</Text>
              </TouchableOpacity>
            </View>
          )}
        </View>
      </View>
    </ScrollView>
  );
};
==== FILE: ./src/ui/screens/Dashboard/DashboardScreen.tsx ====
import * as React from 'react';
import { useMemo } from 'react';
import { View, ScrollView, RefreshControl, Text } from 'react-native';
import { useAppStyles } from '@styles/useAppStyles';
import { useForm } from '@app/context/FormContext';
import { selectFinancialSummaryVM } from '@/ui/selectors/financialSelectors';
import { FinancialSummary } from '@components/FinancialSummary';

// Props interface (WAI-006B-A)
interface DashboardProps {
  onAddTransaction?: () => void;
  onLogout?: () => void;
  onOpenOptions?: () => void;
  onOpenUndo?: () => void;
}

export const DashboardScreen: React.FC<DashboardProps> = () => {
  const { styles } = useAppStyles();
  const { state, refreshData, isRefreshing } = useForm() as any;

  // ADR-01: Memoize de selector voor performance
  const financialData = useMemo(() => {
    return selectFinancialSummaryVM(state);
  }, [state]);

  return (
    <ScrollView
      style={styles.container}
      refreshControl={
        <RefreshControl
          refreshing={isRefreshing}
          onRefresh={refreshData}
          accessibilityLabel="Vernieuw financiÃ«le gegevens"
        />
      }
    >
      <View style={styles.pageContainer}>
        {/* WAI-009: Pagina titel met de juiste rollen */}
        <Text style={styles.pageTitle} accessibilityRole="header" accessibilityLiveRegion="polite">
          Dashboard
        </Text>

        <FinancialSummary data={financialData} />

        {/* Ruimte voor extra widgets */}
      </View>
    </ScrollView>
  );
};

export default DashboardScreen;
==== FILE: ./src/ui/screens/Options/OptionsScreen.tsx ====
// @ts-nocheck
// src/ui/screens/Options/OptionsScreen.tsx
import * as React from 'react';
import { View, Text, TouchableOpacity, ScrollView } from 'react-native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { useAppStyles } from '@ui/styles/useAppStyles';

type Props = {
  onClose: () => void;
  onSettings: () => void;
  onCsvUpload: () => void;
  onReset: () => void;
};

const OptionsScreen: React.FC<Props> = ({ onClose, onSettings, onCsvUpload, onReset }) => {
  const insets = useSafeAreaInsets();
  const { styles, _colors } = useAppStyles();

  return (
    <View style={styles.container}>
      <View style={styles.pageContainer}>
        <ScrollView
          contentContainerStyle={[styles.scrollContent, { paddingBottom: 120 + insets.bottom }]}
        >
          <Text style={styles.pageTitle}>Options</Text>

          <TouchableOpacity
            style={[styles.button, { marginBottom: 16, marginLeft: 0 }]}
            onPress={onSettings}
          >
            <Text style={styles.buttonText}>Settings</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.button, { marginBottom: 16, marginLeft: 0 }]}
            onPress={onCsvUpload}
          >
            <Text style={styles.buttonText}>CSV upload</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.button, { marginBottom: 16, marginLeft: 0 }]}
            onPress={onReset}
          >
            <Text style={styles.buttonText}>Reset</Text>
          </TouchableOpacity>
        </ScrollView>
      </View>

      <View
        style={[
          styles.buttonContainer,
          { bottom: insets.bottom, paddingBottom: Math.max(20, insets.bottom + 8) },
        ]}
      >
        <TouchableOpacity style={[styles.button, styles.secondaryButton]} onPress={onClose}>
          <Text style={styles.secondaryButtonText}>Terug naar Dashboard</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};

export default OptionsScreen;
==== FILE: ./src/ui/screens/Reset/ResetScreen.tsx ====
// src/ui/screens/Reset/ResetScreen.tsx
import * as React from 'react';
import { View, Text, TouchableOpacity, ScrollView, Alert } from 'react-native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { useAppStyles } from '@ui/styles/useAppStyles';

type Props = {
  onClose: () => void;
  onWissen: () => void;
  onHerstel: () => void;
};

const ResetScreen: React.FC<Props> = ({ onWissen, onHerstel }) => {
  const insets = useSafeAreaInsets();
  const { styles } = useAppStyles();

  const handleWissen = () => {
    Alert.alert(
      'WISSEN - Alle data verwijderen',
      'Dit verwijdert ALLE data inclusief setup, transacties en instellingen. Deze actie kan niet ongedaan worden gemaakt.',
      [
        { text: 'Annuleren', style: 'cancel' },
        { text: 'WISSEN', style: 'destructive', onPress: onWissen },
      ],
    );
  };

  const handleHerstel = () => {
    Alert.alert(
      'HERSTEL - Setup opnieuw doorlopen',
      'Dit reset de setup wizard naar lege velden. Uw transacties en instellingen blijven behouden.',
      [
        { text: 'Annuleren', style: 'cancel' },
        { text: 'HERSTEL', onPress: onHerstel },
      ],
    );
  };

  return (
    <View style={styles.container}>
      <View style={styles.pageContainer}>
        <ScrollView
          contentContainerStyle={[styles.scrollContent, { paddingBottom: 120 + insets.bottom }]}
        >
          <Text style={styles.pageTitle}>Reset Opties</Text>

          <View style={[styles.dashboardCard, { marginBottom: 24 }]}>
            <Text style={[styles.fieldLabel, { marginBottom: 8 }]}>WISSEN</Text>
            <Text style={styles.summaryDetail}>
              Verwijdert ALLE data: setup, transacties, en instellingen. U moet de app opnieuw
              instellen.
            </Text>
            <TouchableOpacity
              style={[styles.button, { backgroundColor: '#FF3B30', marginTop: 16, marginLeft: 0 }]}
              onPress={handleWissen}
            >
              <Text style={styles.buttonText}>WISSEN</Text>
            </TouchableOpacity>
          </View>

          <View style={[styles.dashboardCard, { marginBottom: 24 }]}>
            <Text style={[styles.fieldLabel, { marginBottom: 8 }]}>HERSTEL</Text>
            <Text style={styles.summaryDetail}>
              Reset alleen de setup wizard naar lege velden. Transacties en instellingen blijven
              behouden.
            </Text>
            <TouchableOpacity
              style={[styles.button, { backgroundColor: '#007AFF', marginTop: 16, marginLeft: 0 }]}
              onPress={handleHerstel}
            >
              <Text style={styles.buttonText}>HERSTEL</Text>
            </TouchableOpacity>
          </View>
        </ScrollView>
      </View>
    </View>
  );
};

export default ResetScreen;
==== FILE: ./src/ui/screens/Settings/SettingsScreen.tsx ====
// src/ui/screens/Settings/SettingsScreen.tsx
import * as React from 'react';
import { View, Text, TouchableOpacity, ScrollView, Switch } from 'react-native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { useAppStyles } from '@ui/styles/useAppStyles';
import { useTheme } from '@app/context/ThemeContext';

type Props = {
  onClose: () => void;
};

const SettingsScreen: React.FC<Props> = ({ onClose }) => {
  const insets = useSafeAreaInsets();
  const { styles } = useAppStyles();
  const { theme, setTheme } = useTheme();
  const [notificationsEnabled, setNotificationsEnabled] = React.useState(false);

  return (
    <View style={styles.container}>
      <View style={styles.pageContainer}>
        <ScrollView
          contentContainerStyle={[styles.scrollContent, { paddingBottom: 120 + insets.bottom }]}
        >
          <Text style={styles.pageTitle}>Settings</Text>

          {/* Dark Mode Toggle */}
          <View style={[styles.dashboardCard, { marginBottom: 16 }]}>
            <View
              style={{
                flexDirection: 'row',
                justifyContent: 'space-between',
                alignItems: 'center',
              }}
            >
              <Text style={styles.fieldLabel}>Dark mode</Text>
              <Switch
                value={theme === 'dark'}
                onValueChange={(value) => setTheme(value ? 'dark' : 'light')}
              />
            </View>
            <Text style={styles.summaryDetail}>Status: {theme === 'dark' ? 'Aan' : 'Uit'}</Text>
          </View>

          {/* Notifications Toggle */}
          <View style={[styles.dashboardCard, { marginBottom: 16 }]}>
            <View
              style={{
                flexDirection: 'row',
                justifyContent: 'space-between',
                alignItems: 'center',
              }}
            >
              <Text style={styles.fieldLabel}>Meldingen</Text>
              <Switch value={notificationsEnabled} onValueChange={setNotificationsEnabled} />
            </View>
            <Text style={styles.summaryDetail}>
              Status: {notificationsEnabled ? 'Aan' : 'Uit'} (Placeholder functie)
            </Text>
          </View>
        </ScrollView>
      </View>

      {/* Footer */}
      <View
        style={[
          styles.buttonContainer,
          { bottom: insets.bottom, paddingBottom: Math.max(20, insets.bottom + 8) },
        ]}
      >
        <TouchableOpacity style={[styles.button, styles.secondaryButton]} onPress={onClose}>
          <Text style={styles.secondaryButtonText}>Terug naar Options</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};

export default SettingsScreen;
==== FILE: ./src/ui/screens/Wizard/CriticalErrorScreen.tsx ====
import * as React from 'react';
import { View, Text, Button } from 'react-native';
import { useAppStyles } from '@ui/styles/useAppStyles';

type Props = { onReset: () => void };

const CriticalErrorScreen: React.FC<Props> = ({ onReset }) => {
  const { styles } = useAppStyles();
  return (
    <View style={styles.container}>
      <Text style={styles.pageTitle}>
        Er is een kritieke fout opgetreden in de data-integriteit.
      </Text>
      <Button title="Reset Applicatie" onPress={onReset} color="red" />
    </View>
  );
};
export default CriticalErrorScreen;
==== FILE: ./src/ui/screens/Wizard/LandingScreen.tsx ====
import * as React from 'react';
import { View, Text, TouchableOpacity } from 'react-native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { useAppStyles } from '@styles/useAppStyles';
import { useForm } from '@app/context/FormContext';

interface Props {
  onSignup?: () => void;
  onSignin?: () => void;
}

const LandingScreen: React.FC<Props> = ({ onSignup, onSignin }) => {
  const { styles } = useAppStyles();
  const insets = useSafeAreaInsets();
  const { dispatch } = useForm();

  // Phoenix 2025 logica: we gebruiken de SET_STEP actie uit FormAction
  const handleStart = () => {
    if (onSignup) {
      onSignup();
    }
    // Aangepast naar SET_STEP omdat SET_VALUE niet bestaat in je types
    dispatch({ type: 'SET_STEP', payload: 'WIZARD' });
  };

  const handleLogin = () => {
    if (onSignin) {
      onSignin();
    }
    // Aangepast naar SET_STEP omdat SET_VALUE niet bestaat in je types
    dispatch({ type: 'SET_STEP', payload: 'DASHBOARD' });
  };

  return (
    <View style={[styles.container, { paddingBottom: Math.max(20, insets.bottom + 8) }]}>
      <View style={styles.pageContainer}>
        <Text style={styles.pageTitle}>Welkom</Text>
        <Text style={styles.summaryDetail}>
          Start met het instellen van uw huishouding of ga direct naar het dashboard.
        </Text>
      </View>

      <View style={[styles.buttonContainer, { paddingBottom: insets.bottom }]}>
        <TouchableOpacity style={styles.button} onPress={handleStart}>
          <Text style={styles.buttonText}>Aanmelden</Text>
        </TouchableOpacity>

        <TouchableOpacity style={[styles.button, styles.secondaryButton]} onPress={handleLogin}>
          <Text style={styles.secondaryButtonText}>Inloggen</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};

export default LandingScreen;
==== FILE: ./src/ui/screens/Wizard/SplashScreen.tsx ====
import * as React from 'react';
import { View, Text, ActivityIndicator } from 'react-native';
import { useAppStyles } from '@ui/styles/useAppStyles';

const SplashScreen: React.FC<any> = () => {
  const { styles, colors } = useAppStyles() as any;
  return (
    <View style={styles.container}>
      <ActivityIndicator color={colors.primary} />
      <Text style={styles.pageTitle}>Phoenix wordt geladen...</Text>
    </View>
  );
};
export default SplashScreen;
==== FILE: ./src/ui/screens/Wizard/WelcomeWizard.tsx ====
import * as React from 'react';
import { View, Text } from 'react-native';
import { useAppStyles } from '@ui/styles/useAppStyles';

const WelcomeWizard: React.FC<any> = () => {
  const { styles } = useAppStyles();
  return (
    <View style={styles.container}>
      <Text style={styles.pageTitle}>Welkom bij de nieuwe Cashflow Wizard.</Text>
    </View>
  );
};
export default WelcomeWizard;
==== FILE: ./src/ui/screens/Wizard/WizardController.tsx ====
import * as React from 'react';
import { useForm } from '@app/context/FormContext';
import { WizardPage } from './WizardPage';
// Importeer de losse configs als bouwstenen
import { setupHouseholdConfig } from './pages/1setupHousehold.config';
import { detailsHouseholdConfig } from './pages/2detailsHousehold.config';
import { incomeDetailsConfig } from './pages/3incomeDetails.config';
import { fixedExpensesConfig } from './pages/4fixedExpenses.config';

const WizardController: React.FC = () => {
  const { state, dispatch } = useForm();

  // Dynamische mapping op basis van activeStep (conform je stateModel)
  const getConfig = () => {
    switch (state.activeStep) {
      case 'WIZARD_SETUP':
        return setupHouseholdConfig;
      case 'WIZARD_DETAILS':
        return detailsHouseholdConfig;
      case 'WIZARD_INCOME':
        return incomeDetailsConfig;
      case 'WIZARD_EXPENSES':
        return fixedExpensesConfig;
      default:
        return setupHouseholdConfig;
    }
  };

  const config = getConfig();

  return (
    <WizardPage
      config={config}
      isFirst={state.activeStep === 'WIZARD_SETUP'}
      isLast={state.activeStep === 'WIZARD_EXPENSES'}
      onNext={() => dispatch({ type: 'NEXT_STEP' })}
      onBack={() => dispatch({ type: 'PREV_STEP' })}
    />
  );
};

export default WizardController;
==== FILE: ./src/ui/screens/Wizard/WizardPage.tsx ====
import * as React from 'react';
import { View, Text, ScrollView, StyleSheet } from 'react-native';
import { useForm } from '@app/context/FormContext';
import FormField from '@components/fields/FormField';
import { WizardPageConfig, DataSection } from '@shared-types/form';
import { evaluateVisibleIf } from '../../../utils/fieldVisibility';

interface WizardPageProps {
  config: WizardPageConfig;
  onNext: () => void;
  onBack: () => void;
  isFirst: boolean;
  isLast: boolean;
}

export const WizardPage: React.FC<WizardPageProps> = ({ config }) => {
  const { state, dispatch } = useForm();

  return (
    <View style={styles.container}>
      {config.titleToken && <Text style={styles.title}>{config.titleToken}</Text>}
      {config.title && <Text style={styles.title}>{config.title}</Text>}

      <ScrollView style={styles.scrollContainer}>
        {config.fields.map((field) => {
          const targetSection: DataSection = field.section || config.section || 'setup';
          const sectionData = state.data[targetSection];
          const value = (sectionData as any)?.[field.fieldId];

          // Gebruik de centrale util voor SSOT zichtbaarheid
          if (!evaluateVisibleIf(field.visibleIf, state)) {
            return null;
          }

          return (
            <FormField
              key={field.fieldId}
              field={field}
              state={state}
              dispatch={dispatch}
              value={value}
            />
          );
        })}
      </ScrollView>
    </View>
  );
};

const styles = StyleSheet.create({
  container: { flex: 1, padding: 16 },
  title: { fontSize: 24, fontWeight: 'bold', marginBottom: 16 },
  scrollContainer: { flex: 1 },
});